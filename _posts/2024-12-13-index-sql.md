---
layout: post
title: Hiá»ƒu rÃµ vá» Index trong CÆ¡ sá»Ÿ Dá»¯ liá»‡u - CÃ¡ch tá»‘i Æ°u truy váº¥n hiá»‡u quáº£
subtitle: Index â€“ trá»£ thá»§ Ä‘áº¯c lá»±c giÃºp tÄƒng tá»‘c Ä‘á»™ truy váº¥n vÃ  cáº£i thiá»‡n hiá»‡u nÄƒng cho há»‡ quáº£n trá»‹ cÆ¡ sá»Ÿ dá»¯ liá»‡u.
cover-img: /assets/img/code-sql.jpg
thumbnail-img: /assets/img/sql-thumb.png
share-img: /assets/img/sql.bin
tags: [books, blogs, SQL Server]
comments: true
---

>Trong tháº¿ giá»›i cá»§a cÆ¡ sá»Ÿ dá»¯ liá»‡u, **Index (chá»‰ má»¥c)** Ä‘Ã³ng vai trÃ² nhÆ° má»¥c lá»¥c cá»§a má»™t cuá»‘n sÃ¡ch â€“ giÃºp truy xuáº¥t dá»¯ liá»‡u nhanh chÃ³ng mÃ  khÃ´ng cáº§n pháº£i duyá»‡t toÃ n bá»™ báº£ng dá»¯ liá»‡u. Náº¿u báº¡n Ä‘ang xÃ¢y dá»±ng má»™t há»‡ thá»‘ng cÃ³ lÆ°á»£ng dá»¯ liá»‡u lá»›n vÃ  yÃªu cáº§u truy váº¥n nhanh, viá»‡c sá»­ dá»¥ng Index lÃ  má»™t ká»¹ thuáº­t khÃ´ng thá»ƒ bá» qua.

<div style="border: 1px solid #e6e6e6; margin:48px 0"></div>

### 1. Æ¯u Ä‘iá»ƒm cá»§a Index
Index giÃºp **tÄƒng tá»‘c Ä‘á»™ truy váº¥n** (`SELECT`) báº±ng cÃ¡ch Ä‘á»‹nh vá»‹ nhanh dÃ²ng dá»¯ liá»‡u trong báº£ng. Äiá»u nÃ y Ä‘áº·c biá»‡t há»¯u Ã­ch vá»›i cÃ¡c cÃ¢u truy váº¥n cÃ³ Ä‘iá»u kiá»‡n lá»c, sáº¯p xáº¿p, hay join nhiá»u báº£ng.

_VÃ­ dá»¥: thay vÃ¬ pháº£i quÃ©t toÃ n bá»™ báº£ng sinh viÃªn Ä‘á»ƒ tÃ¬m sinh viÃªn cÃ³ mÃ£ lÃ  "SV001", Index giÃºp há»‡ quáº£n trá»‹ CSDL tÃ¬m trá»±c tiáº¿p dÃ²ng Ä‘Ã³ nhÆ° tra má»™t tá»« khÃ³a trong tá»« Ä‘iá»ƒn._

<div style="border: 1px solid #e6e6e6; margin:64px 0"></div>

### 2. NhÆ°á»£c Ä‘iá»ƒm khi sá»­ dá»¥ng Index
**TÄƒng dung lÆ°á»£ng lÆ°u trá»¯**

* Má»—i chá»‰ má»¥c (index) chiáº¿m thÃªm khÃ´ng gian Ä‘Ä©a.

* Vá»›i nhiá»u index, dung lÆ°á»£ng cÃ³ thá»ƒ tÄƒng Ä‘Ã¡ng ká»ƒ â€” nháº¥t lÃ  vá»›i báº£ng lá»›n.

**Giáº£m hiá»‡u nÄƒng khi ghi (`INSERT`, `UPDATE`, `DELETE`)**

* Khi dá»¯ liá»‡u thay Ä‘á»•i, cÃ¡c index liÃªn quan cÅ©ng cáº§n Ä‘Æ°á»£c cáº­p nháº­t.

* Äiá»u nÃ y khiáº¿n cÃ¡c thao tÃ¡c ghi cháº­m hÆ¡n so vá»›i khi khÃ´ng cÃ³ index.

**Quáº£n lÃ½ phá»©c táº¡p hÆ¡n**

* Cáº§n phÃ¢n tÃ­ch vÃ  theo dÃµi Ä‘á»ƒ Ä‘áº£m báº£o index Ä‘ang há»— trá»£ Ä‘Ãºng truy váº¥n.

* Dá»… gÃ¢y dÆ° thá»«a náº¿u táº¡o quÃ¡ nhiá»u index khÃ´ng cáº§n thiáº¿t.

**KhÃ´ng pháº£i truy váº¥n nÃ o cÅ©ng táº­n dá»¥ng Ä‘Æ°á»£c index**

* Má»™t sá»‘ truy váº¥n (nhÆ° truy váº¥n vá»›i hÃ m tÃ­nh toÃ¡n hoáº·c `LIKE` vá»›i kÃ½ tá»± Ä‘áº§u lÃ  %) cÃ³ thá»ƒ khÃ´ng táº­n dá»¥ng Ä‘Æ°á»£c index.

* Khi Ä‘Ã³, dÃ¹ cÃ³ index nhÆ°ng hiá»‡u nÄƒng khÃ´ng cáº£i thiá»‡n.

**Index cÃ³ thá»ƒ bá»‹ "miss" (bá» qua)**

* Náº¿u khÃ´ng viáº¿t truy váº¥n chuáº©n hoáº·c Ä‘Ãºng cÃ¡ch, há»‡ quáº£n trá»‹ cÆ¡ sá»Ÿ dá»¯ liá»‡u (DBMS) cÃ³ thá»ƒ khÃ´ng sá»­ dá»¥ng index báº¡n Ä‘Ã£ táº¡o, dáº«n Ä‘áº¿n viá»‡c "tá»‘n chá»— mÃ  khÃ´ng hiá»‡u quáº£".

<div style="border: 1px solid #e6e6e6; margin:64px 0"></div>

### 3. CÃ³ 2 kiá»ƒu Index chÃ­nh
**ğŸ”¹ Clustered Index**  
* Dá»¯ liá»‡u trong báº£ng Ä‘Æ°á»£c **sáº¯p xáº¿p theo thá»© tá»± cá»§a chá»‰ má»¥c.**

* Má»—i báº£ng **chá»‰ cÃ³ duy nháº¥t má»™t Clustered Index.**

* ThÆ°á»ng Ã¡p dá»¥ng cho **Primary Key.**

_ğŸ§  VÃ­ dá»¥: Náº¿u báº¡n táº¡o Clustered Index trÃªn `ma_sinh_vien`, cÃ¡c dÃ²ng dá»¯ liá»‡u trong báº£ng sáº½ Ä‘Æ°á»£c sáº¯p xáº¿p tÄƒng dáº§n theo `ma_sinh_vien`._

**ğŸ”¹ Non-Clustered Index**  
* **KhÃ´ng sáº¯p xáº¿p dá»¯ liá»‡u váº­t lÃ½** trong báº£ng.

* Má»™t báº£ng cÃ³ thá»ƒ cÃ³ **nhiá»u Non-Clustered Index.**

* ThÆ°á»ng Ä‘Æ°á»£c dÃ¹ng cho cÃ¡c cá»™t tra cá»©u, tÃ¬m kiáº¿m phá»¥.

<div style="border: 1px solid #e6e6e6; margin:64px 0"></div>

### 4. Khi nÃ o nÃªn dÃ¹ng Index
**Truy váº¥n dá»¯ liá»‡u lá»›n thÆ°á»ng xuyÃªn**

* Nhá»¯ng báº£ng cÃ³ hÃ ng ngÃ n, hÃ ng triá»‡u dÃ²ng vÃ  thÆ°á»ng xuyÃªn truy váº¥n theo Ä‘iá»u kiá»‡n (`WHERE`, `JOIN`, `ORDER BY`, `GROUP BY`...) sáº½ hÆ°á»Ÿng lá»£i lá»›n tá»« Index.

**Cá»™t Ä‘Æ°á»£c lá»c hoáº·c sáº¯p xáº¿p thÆ°á»ng xuyÃªn**

* Náº¿u má»™t cá»™t hay Ä‘Æ°á»£c dÃ¹ng trong Ä‘iá»u kiá»‡n tÃ¬m kiáº¿m, lá»c, sáº¯p xáº¿p â€” nÃªn táº¡o Index cho cá»™t Ä‘Ã³.

**TÃ¬m kiáº¿m vá»›i khÃ³a chÃ­nh hoáº·c giÃ¡ trá»‹ duy nháº¥t**

* Index giÃºp truy cáº­p nhanh chÃ³ng, Ä‘áº·c biá»‡t vá»›i cÃ¡c cá»™t `Primary Key`, `Unique`, hoáº·c cÃ¡c trÆ°á»ng Ä‘á»‹nh danh.

**Dá»¯ liá»‡u Ã­t thay Ä‘á»•i**

* Vá»›i báº£ng cÃ³ tÃ­nh cháº¥t â€œchá»‰ Ä‘á»câ€ hoáº·c Ã­t cáº­p nháº­t, viá»‡c sá»­ dá»¥ng Index gáº§n nhÆ° khÃ´ng cÃ³ nhÆ°á»£c Ä‘iá»ƒm nÃ o.

<div style="border: 1px solid #e6e6e6; margin:64px 0"></div>

### 5. Khi nÃ o KHÃ”NG nÃªn dÃ¹ng Index?
**Báº£ng nhá»**

* Vá»›i cÃ¡c báº£ng chá»‰ cÃ³ vÃ i chá»¥c dÃ²ng, viá»‡c dÃ¹ng Index lÃ  dÆ° thá»«a vÃ¬ quÃ©t toÃ n bá»™ báº£ng (table scan) cÃ²n nhanh hÆ¡n.

**Cá»™t cÃ³ giÃ¡ trá»‹ trÃ¹ng láº·p cao**

* Nhá»¯ng cá»™t nhÆ° `giá»›i tÃ­nh`, `tráº¡ng thÃ¡i`... cÃ³ Ã­t giÃ¡ trá»‹ khÃ¡c nhau khÃ´ng nÃªn dÃ¹ng index vÃ¬ khÃ´ng hiá»‡u quáº£.

**Cá»™t thÆ°á»ng xuyÃªn bá»‹ cáº­p nháº­t**

* Náº¿u báº¡n thÆ°á»ng xuyÃªn `UPDATE`, `INSERT`, `DELETE` trÃªn cá»™t Ä‘Æ°á»£c index, há»‡ thá»‘ng sáº½ tá»‘n thÃªm tÃ i nguyÃªn Ä‘á»ƒ cáº­p nháº­t chá»‰ má»¥c.

**QuÃ¡ nhiá»u Index trÃªn má»™t báº£ng**

* Äiá»u nÃ y khiáº¿n viá»‡c ghi dá»¯ liá»‡u cháº­m láº¡i vÃ  lÃ m tÄƒng dung lÆ°á»£ng lÆ°u trá»¯.

<div style="border: 1px solid #e6e6e6; margin:64px 0"></div>

### 6. Má»™t sá»‘ thuá»™c tÃ­nh khÃ¡c cá»§a Index

<div style='margin-top:24px'></div>

|  ***Thuá»™c tÃ­nh***                              |  ***MÃ´ táº£***                                         |
|----------------------------------------|--------------------------------------------|
|  _Má»—i báº£ng chá»‰ cÃ³ 1 Clustered Index_         |  _Do chá»‰ cÃ³ 1 cÃ¡ch sáº¯p xáº¿p váº­t lÃ½ dá»¯ liá»‡u_       |
|  _Primary Key â‡’ Clustered máº·c Ä‘á»‹nh_          |  _Tá»± Ä‘á»™ng náº¿u khÃ´ng chá»‰ Ä‘á»‹nh khÃ¡c_               |
|  _Unique â‡’ Non-Clustered máº·c Ä‘á»‹nh_           |  _Tá»± Ä‘á»™ng náº¿u khÃ´ng chá»‰ Ä‘á»‹nh khÃ¡c_               |
|  _CÃ³ thá»ƒ táº¡o nhiá»u Non-Clustered Index_      |  _PhÃ¹ há»£p cho nhiá»u má»¥c Ä‘Ã­ch tÃ¬m kiáº¿m_           |

<div style="border: 1px solid #e6e6e6; margin:64px 0"></div>

### 7. CÃ¢u lá»‡nh SQL máº«u
**Táº¡o Clustered Index**  
```
create clustered index index_ma_sinh_vien 
on sinh_vien(ma_sinh_vien);
```
<div style='margin-bottom:24px'></div>

**Táº¡o Non-Clustered Index**
```
create nonclustered index index_tim_kiem_ma_ten_sinh_vien 
on sinh_vien(ma_sinh_vien, ten_sinh_vien);
```

<div style='margin-bottom:24px'></div>

**XoÃ¡ Index**
```
drop index sinh_vien(index_ma_sinh_vien);
```
<div style="border: 1px solid #e6e6e6; margin:64px 0"></div>

### 8. Tá»•ng káº¿t

<div style='margin-top:24px'></div>

| ***Clustered Index***                      |  ***Non-Clustered Index***           |
|------------------------------------|------------------------------|
|  _Sáº¯p xáº¿p váº­t lÃ½ dá»¯ liá»‡u_              |  _KhÃ´ng sáº¯p xáº¿p váº­t lÃ½_          |
|  _Tá»‘i Ä‘a 1 trÃªn má»—i báº£ng_              |  _CÃ³ thá»ƒ nhiá»u_                 |
|  _ThÆ°á»ng dÃ¹ng cho Primary Key_        |  _DÃ¹ng cho tra cá»©u phá»¥_         |

<div style='margin-top:24px'></div>

Viá»‡c sá»­ dá»¥ng Ä‘Ãºng loáº¡i Index, Ä‘Ãºng má»¥c Ä‘Ã­ch khÃ´ng chá»‰ giÃºp há»‡ thá»‘ng cháº¡y nhanh hÆ¡n mÃ  cÃ²n **giáº£m táº£i cho cÆ¡ sá»Ÿ dá»¯ liá»‡u**, tiáº¿t kiá»‡m tÃ i nguyÃªn vÃ  tÄƒng tráº£i nghiá»‡m ngÆ°á»i dÃ¹ng.

